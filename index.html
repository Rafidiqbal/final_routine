<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Study Tracker</title>
<style>
    body { font-family: Arial, sans-serif; background: #1e1e1e; color: #fff; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    #controls { text-align: center; margin-bottom: 20px; }
    #addSubjectBtn { background: #ff9800; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; color: #fff; font-size: 16px; }
    #timer { text-align: center; font-size: 18px; margin-bottom: 20px; }
    #overall-container { margin-bottom: 30px; }
    .progress-bar { background: #444; border-radius: 5px; height: 15px; overflow: hidden; }
    .progress { height: 100%; background: #4caf50; width: 0%; }
    .subject { background: #2a2a2a; margin-bottom: 15px; border-radius: 8px; padding: 15px; position: relative; }
    .delete-subject { position: absolute; top: 10px; right: 10px; background: red; border: none; border-radius: 5px; color: #fff; cursor: pointer; padding: 5px 8px; }
    .subject-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
    .topics { margin-top: 10px; display: none; }
    .topic { display: flex; justify-content: space-between; margin-bottom: 5px; background: #333; padding: 5px; border-radius: 5px; align-items: center; }
    .topic button { background: #ff9800; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; margin-left: 5px; }
    .topic .delete-topic { background: red; border-radius: 5px; width: auto; height: auto; padding: 2px 5px; margin-left: 5px; }
    .add-topic { display: flex; margin-top: 10px; }
    .add-topic input, .add-topic button { padding: 5px; margin-right: 5px; border-radius: 5px; border: none; }
    .add-topic button { background: #ff9800; color: #fff; cursor: pointer; }
</style>
</head>
<body>

<h1>Offline Study Tracker</h1>

<div id="controls">
    <button id="addSubjectBtn">+ Add Subject</button>
</div>

<div id="timer"></div>

<div id="overall-container">
    <h3>Overall Progress: <span id="overallText">0%</span></h3>
    <div class="progress-bar">
        <div id="overallProgress" class="progress"></div>
    </div>
</div>

<div id="subjects-container"></div>

<script>
const subjectsContainer = document.getElementById('subjects-container');
const addSubjectBtn = document.getElementById('addSubjectBtn');

let subjectsData = JSON.parse(localStorage.getItem('subjectsData')) || [];

// Save to localStorage
function saveData() {
    localStorage.setItem('subjectsData', JSON.stringify(subjectsData));
}

// Create a subject
function createSubject(subject, index) {
    const div = document.createElement('div');
    div.className = 'subject';

    div.innerHTML = `
        <button class="delete-subject">Delete</button>
        <div class="subject-header">
            <span>${subject.name}</span>
        </div>
        <div class="progress-bar">
            <div class="progress"></div>
        </div>
        <div class="topics"></div>
        <div class="add-topic">
            <input type="text" placeholder="New Topic Name">
            <button>Add Topic</button>
        </div>
    `;

    const header = div.querySelector('.subject-header');
    const topicsDiv = div.querySelector('.topics');
    const progressBar = div.querySelector('.progress');
    const addTopicInput = div.querySelector('.add-topic input');
    const addTopicBtn = div.querySelector('.add-topic button');
    const deleteSubjectBtn = div.querySelector('.delete-subject');

    // Toggle topics
    header.addEventListener('click', () => {
        topicsDiv.style.display = topicsDiv.style.display === 'block' ? 'none' : 'block';
    });

    // Add topic element
    function addTopicElement(name, topicIndex) {
        const topicDiv = document.createElement('div');
        topicDiv.className = 'topic';
        topicDiv.dataset.completed = subject.completed[topicIndex] ? "1" : "0";
        topicDiv.innerHTML = `${name} <div>
            <button>▶</button>
            <button class="delete-topic">x</button>
        </div>`;

        const toggleBtn = topicDiv.querySelector('button');
        const deleteBtn = topicDiv.querySelector('.delete-topic');

        toggleBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            topicDiv.dataset.completed = topicDiv.dataset.completed === "0" ? "1" : "0";
            subject.completed[topicIndex] = topicDiv.dataset.completed === "1";
            updateProgress(subject);
            saveData();
        });

        deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            subject.topics.splice(topicIndex, 1);
            subject.completed.splice(topicIndex, 1);
            topicsDiv.removeChild(topicDiv);
            updateProgress(subject);
            saveData();
        });

        topicsDiv.appendChild(topicDiv);
    }

    // Load existing topics
    subject.topics.forEach((t, i) => addTopicElement(t, i));

    // Add new topic
    addTopicBtn.addEventListener('click', () => {
        const topicName = addTopicInput.value.trim();
        if(!topicName) return alert('Enter a topic name');
        subject.topics.push(topicName);
        subject.completed.push(false);
        addTopicElement(topicName, subject.topics.length -1);
        addTopicInput.value = '';
        updateProgress(subject);
        saveData();
    });

    // Delete subject
    deleteSubjectBtn.addEventListener('click', () => {
        if(!confirm('Delete this subject?')) return;
        subjectsData.splice(index, 1);
        subjectsContainer.removeChild(div);
        updateOverallProgress();
        saveData();
    });

    subjectsContainer.appendChild(div);

    // Update progress for this subject
    function updateProgress(subject) {
        const completedCount = subject.completed.filter(c => c).length;
        const percent = subject.topics.length ? Math.round((completedCount / subject.topics.length) * 100) : 0;
        progressBar.style.width = percent + '%';
        subject.progress = percent;
        updateOverallProgress();
    }

    updateProgress(subject);
}

// Overall progress
function updateOverallProgress() {
    const totalPercent = subjectsData.reduce((sum, subj) => sum + subj.progress, 0);
    const overall = subjectsData.length ? Math.round(totalPercent / subjectsData.length) : 0;
    document.getElementById('overallProgress').style.width = overall + '%';
    document.getElementById('overallText').textContent = overall + '%';
}

// Render subjects
subjectsData.forEach((subj, i) => createSubject(subj, i));

// Add subject button
addSubjectBtn.addEventListener('click', () => {
    const name = prompt("Enter subject name:");
    if(!name) return;
    const newSubject = { name: name, topics: ["New Topic 1"], completed: [false], progress:0 };
    subjectsData.push(newSubject);
    createSubject(newSubject, subjectsData.length -1);
    saveData();
});

// Countdown Timer (3 months)
const timerDiv = document.getElementById('timer');
const targetDate = new Date();
targetDate.setMonth(targetDate.getMonth() + 3);

function updateTimer() {
    const now = new Date().getTime();
    const distance = targetDate - now;
    if(distance < 0) { timerDiv.innerHTML = "Time is up!"; return; }
    const days = Math.floor(distance/(1000*60*60*24));
    const hours = Math.floor((distance % (1000*60*60*24))/(1000*60*60));
    const minutes = Math.floor((distance % (1000*60*60))/(1000*60));
    const seconds = Math.floor((distance % (1000*60))/1000);
    timerDiv.innerHTML = `⏳ ${days}d ${hours}h ${minutes}m ${seconds}s left`;
}
setInterval(updateTimer, 1000);
</script>

</body>
</html>
